<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results — ASRS Travel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bookticket.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body data-theme="light">

    <!-- Header -->
    <header>
        <div class="logo" onclick="window.location='/'"><i class="fas fa-plane logo-plane"></i>SRS<span> Travel</span>
        </div>
        <div class="header-actions">
            <a href="/"><button class="btn btn-ghost"><i class="fas fa-arrow-left"></i> New Search</button></a>
            <a href="{{ url_for('logout') }}"><button class="btn btn-danger">Logout</button></a>
        </div>
    </header>

    <!-- Results Header -->
    <div class="results-header">
        <div>
            <h1>
                <span>{{ items|length }}</span>
                {{ travel_type }}s Found
            </h1>
            <p style="color:var(--muted);font-weight:600;margin-top:6px;">
                {{ source }} → {{ destination }} | {{ date }}
            </p>
            {% if s_coords and d_coords and travel_type != 'Hotel' %}
            <p class="meta-info">
                GPS [{{ s_coords[0] }}, {{ s_coords[1] }}] → [{{ d_coords[0] }}, {{ d_coords[1] }}]
            </p>
            {% endif %}
        </div>
        {% if travel_type != 'Hotel' %}
        <div style="text-align:right">
            <p style="font-size:11px;font-weight:800;color:var(--accent);text-transform:uppercase;letter-spacing:1px;">
                Great-Circle Distance</p>
            <p style="font-size:34px;font-weight:900;">{{ distance }} <span style="font-size:16px">km</span></p>
        </div>
        {% endif %}
    </div>

    <!-- ─── Transport Results (Flight / Train / Bus) ─── -->
    {% if travel_type != 'Hotel' %}

    {% set icons = {'Flight': 'fa-plane', 'Train': 'fa-train', 'Bus': 'fa-bus'} %}
    {% set icon_class = icons[travel_type] %}

    <!-- ─── Filters ─── -->
    <div
        style="padding: 0 4%; max-width: 1400px; margin: 20px auto; display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
        <div class="field" style="margin: 0; flex: 1; min-width: 200px;">
            <label style="font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase;">Filter by
                Name</label>
            <input type="text" id="nameFilter" placeholder="e.g. Indigo, Air India..."
                style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text);">
        </div>
        <div class="field" style="margin: 0; flex: 1; min-width: 200px;">
            <label style="font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase;">Max Price:
                ₹<span id="priceVal">10000</span></label>
            <input type="range" id="priceFilter" min="0" max="10000" step="100" value="10000"
                style="width: 100%; margin-top: 10px; cursor: pointer;">
        </div>
    </div>

    <div class="ticket-list">
        {% for item in items %}
        <div class="ticket-card" data-price="{{ item.price|int }}" data-name="{{ item.name|lower }}">

            <!-- Carrier -->
            <div class="ticket-carrier">
                <div class="carrier-label">{{ travel_type }} Provider</div>
                <div class="carrier-name">{{ item.name }}</div>
                <div class="carrier-id">{{ item.id }}</div>
            </div>

            <!-- Route -->
            <div class="ticket-route">
                <div class="city-time">
                    <h3>{{ item.departure }}</h3>
                    <span>{{ source }}</span>
                </div>
                <div class="route-line">
                    <hr>
                    <i class="fas {{ icon_class }} route-icon"></i>
                    <span>{{ item.duration }}</span>
                </div>
                <div class="city-time">
                    <h3>{{ item.arrival }}</h3>
                    <span>{{ destination }}</span>
                </div>
            </div>

            <!-- Class Info -->
            <div class="ticket-class">
                {{ item.tag }}<strong>{{ item.class }}</strong>
            </div>

            <div class="ticket-price">
                <div class="price-amt"><sup>₹</sup>{{ item.price|int }}</div>
                <a href="/book?type={{ travel_type }}&name={{ item.name }}&id={{ item.id }}&dep={{ item.departure }}&arr={{ item.arrival }}&date={{ date }}&price={{ item.price|int }}&src={{ source }}&dst={{ destination }}&cls={{ item.class }}"
                    style="display:block;margin-top:14px;">
                    <button class="btn btn-primary" style="width:100%;">Select</button>
                </a>
            </div>

        </div>
        {% endfor %}
    </div>

    {% else %}
    <!-- ─── Filters ─── -->
    <div
        style="padding: 0 4%; max-width: 1400px; margin: 20px auto; display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
        <div class="field" style="margin: 0; flex: 1; min-width: 200px;">
            <label style="font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase;">Filter by
                Name</label>
            <input type="text" id="nameFilter" placeholder="e.g. Taj, Radisson..."
                style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text);">
        </div>
        <div class="field" style="margin: 0; flex: 1; min-width: 200px;">
            <label style="font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase;">Max Price:
                ₹<span id="priceVal">10000</span></label>
            <input type="range" id="priceFilter" min="0" max="10000" step="100" value="10000"
                style="width: 100%; margin-top: 10px; cursor: pointer;">
        </div>
    </div>

    <div class="hotel-grid-wrapper">
        {% for item in items %}
        <div class="hotel-card" data-price="{{ item.price|int }}" data-name="{{ item.name|lower }}">
            <img src="{{ item.img }}" alt="{{ item.name }}" loading="lazy">
            <div class="hotel-body">
                <span class="hotel-badge">{% if item.rating >= 4.8 %}⭐ Top Rated{% else %}✔ Verified Stay{% endif
                    %}</span>
                <div class="hotel-name">{{ item.name }}</div>
                <div class="hotel-room">{{ item.meta }}</div>
                <div class="hotel-amenities">
                    {% for a in item.amenities %}
                    <span class="amenity-tag">{{ a }}</span>
                    {% endfor %}
                </div>
                <div class="hotel-footer">
                    <div>
                        <div class="hotel-price">₹{{ item.price }}</div>
                        <div class="per-night">per night</div>
                    </div>
                    <div>
                        <div class="hotel-rating">★ {{ item.rating }}</div>
                        <a href="/book?type=Hotel&name={{ item.name }}&id={{ item.id }}&date={{ date }}&price={{ item.price }}&dst={{ destination }}&cls={{ item.meta }}&rating={{ item.rating }}"
                            style="display:block;margin-top:10px;">
                            <button class="btn btn-primary">Book Stay</button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ─── Destination Info ─────────────────── -->
    {% if place %}
    <div style="padding:40px 6%;">
        <div class="search-card" style="margin:0;border-radius:22px;">
            <p
                style="font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:2px;color:var(--accent);margin-bottom:12px;">
                Sector Intelligence — {{ destination }}</p>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;">
                <div class="field"><label>Famous For</label>
                    <p style="font-weight:700;margin-top:4px;">{{ place.famous }}</p>
                </div>
                <div class="field"><label>Local Food</label>
                    <p style="font-weight:700;margin-top:4px;">{{ place.local_food }}</p>
                </div>
                <div class="field"><label>Best Time to Visit</label>
                    <p style="font-weight:700;margin-top:4px;">{{ place.best_time }}</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ─── Rating ───────────────────────────── -->
    <div class="rating-section">
        <div class="rating-box">
            <h3>Rate Your Experience</h3>
            <p>How was your booking journey today?</p>
            <div class="stars">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
            </div>
            <button class="btn btn-primary" style="width:200px;">Submit Feedback</button>
            <div class="rating-msg"></div>
        </div>
    </div>

    <footer>&copy; 2026 ASRS Travel</footer>
    <button id="theme-toggle"><i class="fas fa-moon"></i></button>
    <script src="{{ url_for('static', filename='bookticket.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nameFilter = document.getElementById('nameFilter');
            const priceFilter = document.getElementById('priceFilter');
            const priceVal = document.getElementById('priceVal');
            const cards = document.querySelectorAll('.ticket-card, .hotel-card');

            if (cards.length > 0 && priceFilter && priceVal) {
                let maxP = 0;
                cards.forEach(c => {
                    const p = parseInt(c.dataset.price || 0);
                    if (p > maxP) maxP = p;
                });
                if (maxP > 0) {
                    // Round up to nearest 500 for a cleaner slider
                    maxP = Math.ceil(maxP / 500) * 500;
                    priceFilter.max = maxP;
                    priceFilter.value = maxP;
                    priceVal.textContent = maxP.toLocaleString('en-IN');
                }
            }

            const applyFilters = () => {
                if (!nameFilter || !priceFilter) return;
                const nm = nameFilter.value.toLowerCase().trim();
                const max = parseInt(priceFilter.value);

                if (priceVal) priceVal.textContent = max.toLocaleString('en-IN');

                cards.forEach(card => {
                    const cName = card.dataset.name || '';
                    const cPrice = parseInt(card.dataset.price || 0);

                    let visible = true;
                    if (nm && !cName.includes(nm)) visible = false;
                    if (cPrice > max) visible = false;

                    card.style.display = visible ? '' : 'none';
                });
            };

            if (nameFilter) nameFilter.addEventListener('input', applyFilters);
            if (priceFilter) priceFilter.addEventListener('input', applyFilters);
        });
    </script>
</body>

</html>